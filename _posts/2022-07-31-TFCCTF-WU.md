---
title: TFCCTF Writeup
date: 2022-07-31
categories: [wirteup]
tags: [web]
---
# Web

## Calendar

Start container lên sau đó truy cập vào link ta sẽ thấy website build dựa trên wordpress. Thường mấy bài kiểu này sẽ là có 1 chức năng j đấy outdate. 
Check wappalyzer thì thấy WP ver 6.0.1 rồi.


<img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/56b30de5-6e33-4836-9cfb-e08a94ee6f54/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045114Z&X-Amz-Expires=86400&X-Amz-Signature=f1dd436ded5df383ff77b69d3c39484e41554e4161fd60ee358db8cc07188fb2&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">


Bây giờ thử dirsearch xem có ra cái j hay ho không, đợi 1 hồi thì cũng ko ra cái gì thú vị lắm. Tiếp theo mình thử dùng nuclei để scan, thì ra luôn :D


<ing src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ed49a9ad-3300-4c18-930c-16a77e052294/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045320Z&X-Amz-Expires=86400&X-Amz-Signature=6037445bc6dff5628adcfb4c3446433017709ef85a9b3b24a8242771c2927298&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">
  
Google CVE nào
  
  
<img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/b8028d31-b054-494c-873e-9677d089f874/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045348Z&X-Amz-Expires=86400&X-Amz-Signature=c7e230e6aa99d2db127b7ee26af14a9d010efc6bfcfa89a9f80c96b5abf0d240&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">
  
Vậy là chức năng calendar của web này bị outdate. Giờ kiếm poc thôi :)), link POC https://github.com/Hacker5preme/Exploits/blob/main/Wordpress/CVE-2021-24146/
Chạy POC
  
<img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/beaa1baf-a593-443e-88b4-7e0dcd82785f/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045503Z&X-Amz-Expires=86400&X-Amz-Signature=8622b860c00ad060547a8c3eba5b7f7d2499d1ffc5ba8e869e04bd359224e353&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">

 <img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/fa4e4c9b-2b40-4321-8e74-2c8403f24175/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045531Z&X-Amz-Expires=86400&X-Amz-Signature=26fafd12e41fcd23d605386c2f00152855ce2ab86b1d1c5af7dfaedf8ca035ad&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">
  
  Done
  
  
  
  ## Are you the admin
  
  Start container sau đó truy cập vào link, thấy giao diện như sau:
  
  
  <img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/9797e7f8-8443-4365-94d3-83c0a75c4b70/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045619Z&X-Amz-Expires=86400&X-Amz-Signature=e60868106b831f04ea9fa684a22e20dcb6bebea5b3497bcb175e82c51c8560c6&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">

  
  Sau khi nhập bừa một vài thứ thì trông nó sẽ như thế này.
  
  
    <img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/5bee5662-dc4a-42a1-8755-d610d1915784/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045712Z&X-Amz-Expires=86400&X-Amz-Signature=93424ff2b637c337e4c2c824d6e6fd74e88efe41be1f8d4b2514513cd5dfb1ed&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">
  
  Có vẻ hướng giải bài này sẽ là làm sao để trang web nghĩ detect là admin. Cho chạy qua burp proxy để bắt requests thì thấy khi nhập username vào rồi bấm create thì username sẽ được truyền qua /api/auth dưới dạng json
  
  
    <img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/9c1794be-4d9f-48a2-a3e7-62cd9ba9587b/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045751Z&X-Amz-Expires=86400&X-Amz-Signature=20294d0cb09c09b6de7dbc735c53dc4028f4260d53aff9c6107870ddefe1294b&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">
 
  Bây giờ phải đi check code xem cái đoạn api/auth này nó sẽ hoạt động như thế nào. Đây là 3 file source mà đề bài cho, lần đầu mình thấy những file có phần đuôi như thế này :)))
  
  
  <img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/55bd5fa5-f85f-4109-8425-a58f6ac1b03e/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045828Z&X-Amz-Expires=86400&X-Amz-Signature=c44df7e22e19645fb59ebebdfc9722bb18a08b852a7db3f5d25952dc7d0a3e9d&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">

  Tra google thì biết là file .ts là file chứa code TypeScript còn file .tsx là file bao gồm JSX  (JSX = Js + XML, transform cú pháp dạnh gần như XMl về thành js, giúp coder có thể code ReactJs bằng cú pháp của XML). Prisma là 1 layer nằm giữa webserver và database
  
  Trong file index.tsx có:
  
  <img src = "https://s3.us-west-2.amazonaws.com/secure.notion-static.com/56f6c42e-8f7b-45a4-99e9-2897c51f9c12/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045856Z&X-Amz-Expires=86400&X-Amz-Signature=cdc20f028e7d6ae262710b476884709de21d0acc49fefaecbdf147e9bf486868&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">
  
  Theo mình hiểu là khi mình nhập username vào thì username sẽ được truyền qua POST sao đó thì sẽ được in ra, nhưng mà ngoài username thì còn 1 biến nữa tên là isAdmin, code sẽ check nếu isAdmin trả về true thì sẽ in ra flag.
  Trong file .prisma ta thấy 
  
  
  <img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ebe75de4-011a-48d2-8e8b-5c7fe96f5749/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T045948Z&X-Amz-Expires=86400&X-Amz-Signature=d0d4eb26a80ca4d9104d5b82c86ff4d8310a2fc90440dbc81ceea3c25777eec2&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">

  là isAdmin dạng boolean và default value của nó sẽ là false. Vậy mình sẽ phải thêm giá trị isAdmin để truyền đi. Sửa requests như sau:
  
  
  <img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/193ddc39-6b58-4feb-b632-0fd724899c8d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T050022Z&X-Amz-Expires=86400&X-Amz-Signature=b1d4fe2687b1fde2f39433b8306e3801f152d0ed451faf764ae0edf81080372b&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">
  
  Send sau đó reload lại web ta sẽ được flag
  
  
  <img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/f86e0b28-8a64-4935-a3b2-556e98d76230/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Content-Sha256=UNSIGNED-PAYLOAD&X-Amz-Credential=AKIAT73L2G45EIPT3X45%2F20220731%2Fus-west-2%2Fs3%2Faws4_request&X-Amz-Date=20220731T050047Z&X-Amz-Expires=86400&X-Amz-Signature=c89fdabdfbe1aedfebd787ceb77c1e2ecd71eeff89c7139c1127dc05e94724dd&X-Amz-SignedHeaders=host&response-content-disposition=filename%20%3D%22Untitled.png%22&x-id=GetObject">
  
  Flag: `TFCCTF{S4n1t1z3_Y0ur_1nput5!}`
